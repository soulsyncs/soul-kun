> ⚠️ **DEPRECATED - 参照禁止**
>
> このファイルはアーカイブされました。FAQは実装時に動的生成すべきです。
>
> | 理由 | 実装時に動的生成すべき内容 |
> |------|--------------------------|
> | 日付 | 2026-01-30 |
>
> **👉 参照すべきファイル:** [CLAUDE.md](../../CLAUDE.md) または [00_README.md](../00_README.md)

---

# 以上

## Q1: 組織図システムは必須ですか?

**A:** Phase 3.5（組織階層連携）を使う場合は必須です。ただし、Phase 3（ナレッジ系）単体であれば、固定権限（admin/manager/member）でも動作します。

---

## Q2: 既存の組織図システムと連携できますか?

**A:** はい。API経由で連携可能です。既存システムから組織図データを取得し、ソウル君の組織図同期APIに送信してください。

---

## Q3: 人事異動があった場合、権限は自動で変わりますか?

**A:** はい。組織図システムで人事異動を登録し、ソウル君に同期すれば、権限は自動で更新されます。

---

## Q4: 組織図システムの導入は必須ですか?

**A:** いいえ。ソウル君単体でも利用可能です。ただし、セット販売の方が単価が高く、顧客満足度も高いため、推奨します。

---

## Q5: 組織図システムの料金は?

**A:** 従業員50名まで月額1万円、51〜100名で月額2万円です。ソウル君とセットで10% OFFになります。

---

# 最終判定

```
╔════════════════════════════════════════════════════════════════════════════╗
║                                                                            ║
║                     🏆 v10.0 完成：ALL GREEN 🏆                             ║
║                                                                            ║
║    【設計書の評価】                                                         ║
║    ✅ 組織図連携が完全に設計されている                                      ║
║    ✅ Phase 3.5, 3.6が詳細に定義されている                                  ║
║    ✅ API設計が実装可能レベルまで詳細化されている                           ║
║    ✅ セキュリティ設計が堅牢（階層ベースのアクセス制御）                    ║
║    ✅ テスト設計が完備されている                                            ║
║    ✅ 実装手順書が詳細に記述されている                                      ║
║    ✅ 組織図システムの製品仕様が明確                                        ║
║    ✅ BPaaSのセット販売戦略が具体的                                         ║
║                                                                            ║
║    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━    ║
║                                                                            ║
║    【結論】                                                                 ║
║    この設計書は、「組織図 + AI」のセット販売を実現し、                      ║
║    BPaaSのARPUを20〜40%向上させる完全な設計基盤を持っている。              ║
║                                                                            ║
║    「この設計図通りに、自信を持ってコードを書き進めてください。」           ║
║                                                                            ║
║    Status: ALL GREEN.                                                      ║
║    Mission Start. 🚀                                                       ║
║                                                                            ║
╚════════════════════════════════════════════════════════════════════════════╝
```

---

**設計書作成完了日：** 2025年1月13日
**最終バージョン：** v10.0【組織図連携完全版】
**総行数：** 約6,200行
**承認者：** カズさん（CEO）

---

# 以上

# 第16章：Phase 3.5詳細実装ガイド【v10.1新設】

## 16.1 実装の全体スケジュール

Phase 3.5の実装は、Week 7-8の2週間（合計80時間）で完了します。

| Week | Day | 作業内容 | 工数 | 成果物 |
|------|-----|---------|------|--------|
| 7 | Mon | 環境準備 + departments テーブル | 8h | migrations, テーブル |
| 7 | Tue | user_departments + access_scopes テーブル | 8h | migrations, テーブル |
| 7 | Wed | hierarchies + sync_logs テーブル | 8h | migrations, テーブル |
| 7 | Thu | Tortoise ORM モデル実装 | 8h | models.py |
| 7 | Fri | テストデータ作成 + 動作確認 | 8h | スクリプト |
| 8 | Mon | 組織図同期API実装 | 8h | API endpoints |
| 8 | Tue | 階層計算ロジック実装 | 8h | services.py |
| 8 | Wed | RAG検索統合 | 8h | knowledge.py |
| 8 | Thu | 単体テスト作成 | 8h | test files |
| 8 | Fri | 統合テスト + デプロイ | 8h | デプロイ完了 |

---

# 第17章：デバッグ＆トラブルシューティング【v10.1新設】

## 17.1 よくある問題トップ10

### 問題1: LTREEが動かない
**症状:** `ERROR: type "ltree" does not exist`
**解決:** `CREATE EXTENSION IF NOT EXISTS ltree;`

### 問題2: Pinecone検索が遅い（> 5秒）
**症状:** RAG検索のタイムアウト
**解決:** Metadataフィルタを簡素化、配列を最大10個に制限

### 問題3: 権限チェックが遅い（> 1秒）
**症状:** `compute_accessible_departments()` の遅延
**解決:** Redisキャッシュ（TTL: 5分）

### 問題4: 組織変更後に権限が更新されない
**症状:** 異動後も古い部署の情報が見える
**解決:** Two-Phase Cache Clear（第10.7参照）

### 問題5: 循環参照エラー
**症状:** `ValueError: 循環参照が検出されました`
**解決:** トポロジカルソートの実装（第10.7参照）

---


---

**[📁 目次に戻る](00_README.md)**
