# Design Coverage Matrix（設計要素カバレッジ表）

**作成日:** 2026-01-30
**目的:** MECEを機械的に保証する（空欄=漏れ、複数=重複として検知）
**更新ルール:** 設計書を変更した際は、この表も必ず更新する

---

## 使い方

1. 新しい設計要素を追加する → この表にSoTを追加
2. 設計書を変更する → この表のSoTを確認し、正しいファイルを編集
3. 空欄を見つけた → 漏れ。対応するドキュメントを作成する
4. 複数セルがある → 重複。SoTを1つに統一する

---

## 1. アーキテクチャ層

| 設計要素 | SoT（正のファイル） | セクション | 状態 | 備考 |
|---------|-------------------|-----------|------|------|
| Context Builder | 25章 | 第5章 | ✅ | |
| LLM Brain（概念） | 25章 | 第5-6章 | ✅ | CLAUDE.mdは要点のみ |
| LLM Brain（鉄則） | CLAUDE.md | セクション2 | ✅ | 25章は詳細設計 |
| Guardian Layer | 25章 | 第4章、第9章 | ✅ | |
| Authorization Gate（原則） | 25章 | 第4章 | ✅ | |
| Authorization Gate（実装） | 04章 | 5.6 | ✅ | 03章はテーブル設計のみ |
| Observability Layer | **未定義** | - | ❌ 漏れ | 監視・アラート戦略が必要 |
| Tool Execution | 25章 | 第7章 | ✅ | |

---

## 2. コア概念・原則

| 設計要素 | SoT（正のファイル） | セクション | 状態 | 備考 |
|---------|-------------------|-----------|------|------|
| 脳の8つの鉄則 | CLAUDE.md | セクション2-1 | ✅ | 25章は設計詳細 |
| LLM Brain 憲法 | 25章 | 第4章 | ✅ | |
| データソース優先順位（Truth順位） | CLAUDE.md | セクション3 | ✅ | |
| 10の鉄則 | CLAUDE.md | セクション5 | ✅ | 09章は参照のみ |
| 設計の5原則 | CLAUDE.md | セクション6 | ✅ | 01章は詳細・背景 |
| 権限レベル（6段階）原則 | CLAUDE.md | セクション7 | ✅ | |
| 権限レベル（6段階）実装 | 04章 | 5.6 | ✅ | |
| System Prompt v2.0 | 25章 | 付録17.4 | ✅ | |

---

## 3. データ・セキュリティ

| 設計要素 | SoT（正のファイル） | セクション | 状態 | 備考 |
|---------|-------------------|-----------|------|------|
| Memory Framework（原則） | CLAUDE.md | セクション8 | ✅ | |
| Memory Framework（詳細設計） | 10_phase2_b | 全体 | ✅ | |
| 監査ログ（原則） | CLAUDE.md | セクション8-3 | ✅ | |
| 監査ログ（実装） | 04章 | 5.6.3 | ✅ | |
| PII処理（原則） | CLAUDE.md | セクション8-2 | ✅ | |
| PII処理（マスキング仕様） | OPERATIONS_RUNBOOK | セクション7.2 | ✅ | 2026-01-30追加 |
| PII処理（削除手順） | OPERATIONS_RUNBOOK | セクション7.3 | ✅ | 2026-01-30追加 |
| Row Level Security | 04章 | 5.6 | ✅ | |
| organization_id必須ルール | CLAUDE.md | セクション5 | ✅ | |
| organization_id初期化・移行 | **未定義** | - | ❌ 漏れ | |

---

## 4. 運用

| 設計要素 | SoT（正のファイル） | セクション | 状態 | 備考 |
|---------|-------------------|-----------|------|------|
| 障害対応（BCP） | security_and_bcp_guide | 全体 | ✅ | |
| 緊急停止手順 | OPERATIONS_RUNBOOK | セクション1 | ✅ | 2026-01-30追加 |
| 権限事故対応 | OPERATIONS_RUNBOOK | セクション3 | ✅ | 2026-01-30追加 |
| コスト管理（見積もり） | 25章 | 1.4 | ✅ | |
| コスト管理（本番運用戦略） | OPERATIONS_RUNBOOK | セクション5 | ✅ | 2026-01-30追加 |
| レート制限 | OPERATIONS_RUNBOOK | セクション6 | ✅ | 2026-01-30追加 |
| 失敗時の挙動（API） | 03章 | 5.2.5 | ✅ | |
| 失敗時の挙動（全体原則） | OPERATIONS_RUNBOOK | セクション8 | ✅ | 2026-01-30追加 |

---

## 5. テスト

| 設計要素 | SoT（正のファイル） | セクション | 状態 | 備考 |
|---------|-------------------|-----------|------|------|
| テスト戦略（全体） | 09章 | 第11章 | ✅ | |
| 単体テスト基準 | 09章 | 11.1 | ✅ | |
| 統合テスト基準 | 09章 | 11.2 | ✅ | |
| E2Eテスト基準 | 09章 | 11.3 | ✅ | |
| セキュリティテスト | 09章 | 11.5 | ✅ | |
| パフォーマンステスト | 09章 | 11.4 | ✅ | |
| 権限境界テスト | 09章 | 11.5 | ✅ | |
| プロンプト回帰テスト | **未定義** | - | ❌ 漏れ | |
| コスト上限テスト | **未定義** | - | ❌ 漏れ | |

---

## 6. 機能別設計（Phase）

| 設計要素 | SoT（正のファイル） | 状態 | 備考 |
|---------|-------------------|------|------|
| タスク管理（Phase 1-B） | 05_phase_1b | ✅ | |
| パターン検出（Phase 2A1） | 06_phase2_a1 | ✅ | |
| 属人化検出（Phase 2A2） | 07_phase2_a2 | ✅ | |
| ボトルネック検出（Phase 2A3） | 08_phase2_a3 | ✅ | |
| 感情検出（Phase 2A4） | 09_phase2_a4 | ✅ | |
| 記憶フレームワーク（Phase 2B） | 10_phase2_b | ✅ | |
| MVV・秘書機能（Phase 2C） | 10_phase2c | ✅ | |
| 目標達成支援（Phase 2.5） | 05_phase2-5 | ✅ | |
| ナレッジ管理（Phase 3） | 05_phase3 | ✅ | |
| 組織階層（Phase 3.5） | 06_phase_3-5, PHASE_3-5_DETAILED | ✅ | |
| BPaaS（Phase 4） | 08_phase_4 | ✅ | |
| 会議系（Phase C） | 07_phase_c | ✅ | |

---

## 7. 技術基盤

| 設計要素 | SoT（正のファイル） | セクション | 状態 | 備考 |
|---------|-------------------|-----------|------|------|
| DB設計（スキーマ） | 03章 | 全体 | ✅ | |
| API設計 | 04章 | 全体 | ✅ | |
| 実装規約 | 09章 | 全体 | ✅ | |
| 環境変数 | ENVIRONMENT_VARIABLES | 全体 | ✅ | |
| 技術スタック | CLAUDE.md | セクション15 | ✅ | |

---

## 漏れサマリー（❌ 要対応）

| # | 漏れている設計要素 | 優先度 | 対応状況 |
|---|-------------------|--------|----------|
| 1 | **Observability Layer全体戦略** | 高 | ⚠️ 今後対応 |
| 2 | ~~緊急停止手順~~ | 高 | ✅ OPERATIONS_RUNBOOK追加 |
| 3 | ~~レート制限~~ | 高 | ✅ OPERATIONS_RUNBOOK追加 |
| 4 | ~~PII処理（マスキング・削除）~~ | 高 | ✅ OPERATIONS_RUNBOOK追加 |
| 5 | ~~権限事故対応~~ | 中 | ✅ OPERATIONS_RUNBOOK追加 |
| 6 | ~~コスト管理（本番運用）~~ | 中 | ✅ OPERATIONS_RUNBOOK追加 |
| 7 | ~~失敗時の挙動（全体原則）~~ | 中 | ✅ OPERATIONS_RUNBOOK追加 |
| 8 | **organization_id初期化・移行** | 中 | ⚠️ 今後対応 |
| 9 | **プロンプト回帰テスト** | 低 | ⚠️ 今後対応 |
| 10 | **コスト上限テスト** | 低 | ⚠️ 今後対応 |

**2026-01-30対応:** 漏れ10項目のうち7項目をOPERATIONS_RUNBOOK.mdで対応完了。残り3項目は今後のイテレーションで対応。

---

## 重複サマリー（⚠️ SoT明確化済み）

以下は重複が発生しやすい領域だが、SoTを明確化済み：

| 設計要素 | SoT | 参照のみ |
|---------|-----|---------|
| LLM Brain | 25章（詳細）、CLAUDE.md（要点） | - |
| 10の鉄則 | CLAUDE.md | 09章（参照） |
| Memory Framework | CLAUDE.md（原則）、10_phase2_b（詳細） | - |
| 監査ログ | CLAUDE.md（原則）、04章（実装） | 03章（テーブル） |
| 権限レベル | CLAUDE.md（原則）、04章（実装） | 03章（テーブル） |

---

## SoT参照ルール

1. **原則・概念を知りたい** → CLAUDE.md
2. **脳の詳細設計を知りたい** → 25章
3. **API・セキュリティ実装を知りたい** → 04章
4. **DB・テーブル設計を知りたい** → 03章
5. **コーディング・テスト基準を知りたい** → 09章
6. **特定機能の詳細を知りたい** → 該当Phase設計書

---

## 更新履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-30 | 初版作成（全設計要素のカバレッジ分析） |
| 2026-01-30 | OPERATIONS_RUNBOOK.md追加により漏れ7項目を解消 |

---

**このファイルについての質問は、CLAUDE.mdを参照してください。**
