# Cloud Scheduler: Googleãƒ‰ãƒ©ã‚¤ãƒ–ç›£è¦–ã‚¸ãƒ§ãƒ–
# 5åˆ†ã”ã¨ã«Googleãƒ‰ãƒ©ã‚¤ãƒ–ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã€ã‚½ã‚¦ãƒ«ãã‚“ã®ãƒŠãƒ¬ãƒƒã‚¸DBã«åæ˜ 
#
# ================================================================
# ç¾åœ¨ã®ç¨¼åƒçŠ¶æ³ï¼ˆ2026-02-21 è¨­å®šæ¸ˆã¿ãƒ»æœ¬ç•ªç¨¼åƒä¸­ï¼‰
# ================================================================
#
# ã‚¸ãƒ§ãƒ–å: watch-google-drive-soulsyncs
# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: 5åˆ†ã”ã¨ï¼ˆAsia/Tokyoï¼‰
# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: Cloud Runï¼ˆwatch-google-driveï¼‰
# çŠ¶æ…‹: ENABLED
#
# å†ä½œæˆã‚³ãƒãƒ³ãƒ‰ï¼ˆæ—¢å­˜ã‚¸ãƒ§ãƒ–ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆã™ã‚‹å ´åˆï¼‰:
#   gcloud scheduler jobs delete watch-google-drive-soulsyncs --location=asia-northeast1 --project=soulkun-production
#   gcloud scheduler jobs create http watch-google-drive-soulsyncs \
#     --location=asia-northeast1 \
#     --schedule="*/5 * * * *" \
#     --time-zone="Asia/Tokyo" \
#     --uri="https://watch-google-drive-tzu7ftekzq-an.a.run.app" \
#     --http-method=POST \
#     --headers="Content-Type=application/json" \
#     --message-body='{"organization_id":"org_soulsyncs","root_folder_id":"1Bw03U0rmjnkAYeFQDEFB75EsouNaOysp"}' \
#     --oidc-service-account-email="scheduler-invoker@soulkun-production.iam.gserviceaccount.com" \
#     --attempt-deadline=540s \
#     --project=soulkun-production

name: watch-google-drive-soulsyncs
description: "Googleãƒ‰ãƒ©ã‚¤ãƒ–ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦ã‚½ã‚¦ãƒ«ãã‚“ã®ãƒŠãƒ¬ãƒƒã‚¸DBã«åæ˜ ï¼ˆ5åˆ†ã”ã¨ï¼‰"

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: 5åˆ†ã”ã¨ã«å®Ÿè¡Œ
schedule: "*/5 * * * *"
timeZone: Asia/Tokyo

# ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®šï¼ˆCloud Runï¼‰
target:
  type: http
  uri: https://watch-google-drive-tzu7ftekzq-an.a.run.app
  httpMethod: POST
  headers:
    Content-Type: application/json
  body: |
    {
      "organization_id": "org_soulsyncs",
      "root_folder_id": "1Bw03U0rmjnkAYeFQDEFB75EsouNaOysp"
    }
  oidcToken:
    serviceAccountEmail: scheduler-invoker@soulkun-production.iam.gserviceaccount.com

# ãƒªãƒˆãƒ©ã‚¤è¨­å®š
retryConfig:
  retryCount: 3
  minBackoffDuration: 10s
  maxBackoffDuration: 300s
  maxDoublings: 3

# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
attemptDeadline: 540s

# ================================================================
# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†æ™‚ã®ç¢ºèªã‚³ãƒãƒ³ãƒ‰
# ================================================================
#
# ã‚¸ãƒ§ãƒ–ç¢ºèª:
#   gcloud scheduler jobs list --project=soulkun-production --location=asia-northeast1 | grep watch
#
# æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ:
#   gcloud scheduler jobs run watch-google-drive-soulsyncs \
#     --location=asia-northeast1 --project=soulkun-production
#
# å®Ÿè¡Œãƒ­ã‚°ç¢ºèª:
#   gcloud logging read 'resource.type="cloud_run_revision" AND resource.labels.service_name="watch-google-drive"' \
#     --project=soulkun-production --limit=10
#
# ================================================================
# æ¨©é™è¨­å®šï¼ˆè¨­å®šæ¸ˆã¿ï¼‰
# ================================================================
#
# scheduler-invoker@soulkun-production.iam.gserviceaccount.com ã«
# watch-google-drive Cloud Runã‚µãƒ¼ãƒ“ã‚¹ã® roles/run.invoker ã‚’ä»˜ä¸æ¸ˆã¿
#
# å†ä»˜ä¸ãŒå¿…è¦ãªå ´åˆ:
#   gcloud run services add-iam-policy-binding watch-google-drive \
#     --region=asia-northeast1 \
#     --member="serviceAccount:scheduler-invoker@soulkun-production.iam.gserviceaccount.com" \
#     --role="roles/run.invoker" \
#     --project=soulkun-production
#
# ================================================================
# Googleãƒ‰ãƒ©ã‚¤ãƒ– ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ï¼ˆå‘½åè¦å‰‡ï¼‰
# ================================================================
#
# ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ID: 1Bw03U0rmjnkAYeFQDEFB75EsouNaOysp
#
# æ¨å¥¨ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ :
#   ğŸ“ ã‚½ã‚¦ãƒ«ãã‚“ç”¨ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰
#   â”œâ”€â”€ ğŸ“ å…¨ç¤¾å…±æœ‰          â† classification: publicï¼ˆå…¨å“¡ãŒè¦‹ã‚‰ã‚Œã‚‹ï¼‰
#   â”‚   â””â”€â”€ ğŸ“ ä¼šç¤¾ç´¹ä»‹ãƒ»MVV
#   â”œâ”€â”€ ğŸ“ ç¤¾å“¡é™å®š          â† classification: internalï¼ˆç¤¾å“¡ã®ã¿ï¼‰
#   â”‚   â”œâ”€â”€ ğŸ“ æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
#   â”‚   â””â”€â”€ ğŸ“ å°±æ¥­è¦å‰‡
#   â”œâ”€â”€ ğŸ“ å½¹å“¡é™å®š          â† classification: restrictedï¼ˆå½¹å“¡ã®ã¿ï¼‰
#   â””â”€â”€ ğŸ“ éƒ¨ç½²åˆ¥            â† classification: confidentialï¼ˆå„éƒ¨ç½²ã®ã¿ï¼‰
#       â”œâ”€â”€ ğŸ“ å–¶æ¥­éƒ¨
#       â””â”€â”€ ğŸ“ ç·å‹™éƒ¨
#
# æ³¨æ„: ãƒ•ã‚©ãƒ«ãƒ€åã«ä¸Šè¨˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œãªã„ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆç¤¾å“¡é™å®šï¼‰ã«ãªã‚‹
#
# ================================================================
